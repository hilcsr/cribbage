<script>


function test(title, expected, actual){
	if (expected===actual){
		console.log("Passed "+title+".");
	}
	else {
		console.log("Failed "+title+". Expected "+expected+", got "+actual+".");
	}
}



function scoreNobs(hand, flop){

	var score = 0;

	for (var i=0; i<hand.length; i++){
		if ( flop[1] === hand[i][1] && hand[i][0] === "J"){
			score += 1;
		}		
	}
	return score;
}

test("Nobs Found", 1, scoreNobs([[3,'s'], [3,'h'], ['J','h']], [8,'h']) );
test("Nae Nobs", 0, scoreNobs([[3,'s'], [3,'h'], ['J','d']], [8,'h']) );



function scorePairs(cards){
 	var score = 0;

	for (var i = 0; i<cards.length; i++){
		for (var j = i+1; j<cards.length; j++){
			if (cards[i][0] === cards[j][0]){
				score += 2;
			}
		}
	}
	return score;
}

test("Three Pairs", 6, scorePairs([ [3,'s'],[3,'h'],[3,'d'],[2,'d'] ]));
test("Nae Pairs", 0, scorePairs([ [5,'s'],[8,'h'],[3,'d'],[2,'d'] ]));


function scoreFlush(hand, flop){
	var score = 0;

	if ( hand[0][1] === hand[1][1] && hand[0][1] === hand[2][1] && hand[0][1] === hand[3][1] ) {
		score += 4;
		if ( hand[0][1] === flop[1] ){
			score += 1;
		}
	}
	return score;
}

test("Four Flush", 4, scoreFlush([ [3,'d'],[4,'d'],[5,'d'],[6,'d'] ], ['Q','c'] ));
test("Five Flush", 5, scoreFlush([ [3,'d'],[4,'d'],[5,'d'],[6,'d'] ], ['Q','d'] ));
test("Nae Flush", 0, scoreFlush([ [5,'s'],[8,'h'],[3,'d'],[2,'d'] ], ['Q','d'] ));


function sumCardsArray(cards){
	
	var cardValueMap = {
		'J' : 10,
		'Q' : 10,
		'K' : 10,
		'A' : 1
	}


	var sum = 0;
	for (var i=0; i<cards.length; i++){
		
		var symbol = cards[i][0];

		if (cardValueMap[symbol]) {
			var value = cardValueMap[symbol];
		}
		else {
			value = symbol;
		}

		sum += value;
	}
	return sum;
}

test("Simple Sum Cards", 11, sumCardsArray([ [3,'s'],[3,'h'],[3,'d'],[2,'d'] ]));
test("Facecard Sum Cards", 31, sumCardsArray([ ['J','s'],['A','h'],['Q','d'],['K','d'] ]));


function cardCombinations(lol, cards){
//console.log("Called with ",lol,cards);

	if (cards.length === 0 ){
		return lol.slice(1);
	}
	else {

		if (lol.length === 0){
			var newLol = [ [], [cards[0]] ];
		}
		else {
			var newLol = lol;
			var lolLength = lol.length;

				for (var i = 0; i<lolLength; i++){
					var addToLol = lol[i].concat([cards[0]]);
					newLol.push(addToLol);
					//console.log(JSON.stringify(newLol));
				}
		}
		return cardCombinations(newLol, cards.slice(1) );
	}

}

//console.log(JSON.stringify(cardCombinations( [], [0,1,2,3,4,5] )));
test('Possible Card Combinations', "[[0],[1],[0,1],[2],[0,2],[1,2],[0,1,2]]" , JSON.stringify(cardCombinations( [], [0,1,2] )));


function scoreFifteens(cards){
	var lol = cardCombinations([], cards);
	//console.log(JSON.stringify(lol));
	//console.log(lol);
	
	var score = 0;

	for (var i = 0; i<lol.length; i++){
		if (sumCardsArray(lol[i]) === 15){
			score += 2;
		}
	}
	return score;
}

test("Fifteens", 6, scoreFifteens([ [3,'s'],[3,'h'],[3,'d'],[2,'d'],['J','d'] ]));
test("Nae Fifteens", 0, scoreFifteens([ [3,'s'],[3,'h'],[3,'d'],[2,'d'],[2,'s'] ]));


function isRun(cards){
	var sortedCards = sortCards(cards);
//	console.log(JSON.stringify(sortedCards));

	var diffTotal = 0;

	if (sortedCards.length >= 3) {
		for (i=1; i<sortedCards.length; i++){
			var subDiffTotal = (sortedCards[i] - sortedCards[i-1]);
			if (subDiffTotal === 0) {
				return false;
			}
			else diffTotal += subDiffTotal;
		}
		if (diffTotal === (sortedCards.length-1)){
			return true;
		}
		else return false;
	}
	else return false;
}

test("Nae Run", false, isRun([ [3,'s'],['J','h'],[3,'d'],[2,'d'],['A','d'] ]));
test("Run", true, isRun([ [3,'s'],[2,'d'],['A','d'] ]));
test("Nae Run2", false, isRun([ [3,'s'],[3,'d'],['A','d'] ]));



function sortCards(cards){

	var cardSortMap = {
			'J' : 11,
			'Q' : 12,
			'K' : 13,
			'A' : 1
		}

	var numericCards = [];
	for (var i=0; i<cards.length; i++){

		var symbol = cards[i][0];

		if (cardSortMap[symbol]) {
				var sortValue = cardSortMap[symbol];
		}
		else { sortValue = symbol; 
		}
		
		numericCards.push(sortValue);
		//console.log(JSON.stringify(numericCards));
	}
		return numericCards.sort(function(a,b){return a-b;});

}
test("Sort", '[1,2,3,3,11]', JSON.stringify(sortCards([ [3,'s'],['J','h'],[3,'d'],[2,'d'],['A','d'] ])));
//test("Sort", 6, sortCards([ [3,'s'],[4,'h'],[3,'d'],[2,'d'],['A','d'] ]));


function scoreRuns(cards){
	var lol = cardCombinations([], cards);

	var score = 0;

	var lolLength = lol.length;

	for (var i=0; i<lolLength; i++){
		if (isRun(lol[i])){
			console.log(JSON.stringify(lol[i]));
			score += 3;
		}
	}
	return score;
}

test("Nae Run Points", 0, scoreRuns([ [3,'s'],[3,'h'],[3,'d'],[2,'d'],['J','d'] ]));
test("Run Points", 12, scoreRuns([ [3,'s'],['A','h'],[3,'d'],[2,'d'],[2,'s'] ]));


function scoreCribbageHand(hand, flop){

	var cards = hand.concat([flop]);
	console.log(JSON.stringify(cards));

	return scorePairs(cards) + scoreRuns(cards) + scoreFifteens(cards) + scoreFlush(hand, flop) + scoreNobs(hand, flop);
}

test("Cribbage Point Counter", 29, scoreCribbageHand( [ [5,'c'],[5,'h'],['J','d'],[5,'s']], [5,'d'] ) );


</script>